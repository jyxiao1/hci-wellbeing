<html>
<head>
  <script src="https://download.affectiva.com/js/3.2/affdex.js"></script>
  <style>
    #emoji { font-size:10em; }
  </style>
</head>
<body>
<div id='video'></div>
<div id='emoji'></div>
</body>
<script>
  window.onload = function() {
    const videoWidth = 640, videoHeight = 480;
    const faceMode = affdex.FaceDetectorMode.LARGE_FACES;

    const detector = new affdex.CameraDetector(
      document.querySelector('#video'),
      videoWidth, videoHeight, faceMode
    );

    detector.detectEmotions.anger = true;
    detector.detectAllEmojis();


    var secondPassed = 0;

    function incrementTime(){
      secondPassed++;
    }

    detector.addEventListener( 'onImageResultsSuccess', function( faces ) {
      if( faces.length > 0 ) {

        while(faces[0].emotions.anger > 10){
          setInterval(incrementTime, 1000);
          if(secondPassed > 2){
            alert('Breathe!!!  Please allow yourself to admit that you are angry!\n' +
              'Here are some calming techniques that you can try:\n\n' +
              'Change your focus: Leave the situation, look in another direction, walk out of the room, or go outside.\n' +
              'Relax your body: Practicing progressive muscle relaxation can help you calm down and center yourself.\n' +
              'Get some fresh air: The temperature and air circulation in a room can increase your anxiety or anger.\n')
          }
        }
        document.querySelector('#emoji').innerText = faces[0].emojis.dominantEmoji
      }
    });

    detector.start()
  }
</script>
</html>
